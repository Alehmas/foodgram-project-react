#  Foodgram - «Продуктовый помощник»

##  Описание
На этом сервисе пользователи смогут публиковать рецепты, подписываться на публикации других пользователей,
добавлять понравившиеся рецепты в список «Избранное», а перед походом в магазин скачивать сводный список
продуктов, необходимых для приготовления одного или нескольких выбранных блюд.

Как будте выглядить приложение можно посмотреть [здесь](https://www.figma.com/file/HHEJ68zF1bCa7Dx8ZsGxFh/%D0%9F%D1%80%D0%BE%D0%B4%D1%83%D0%BA%D1%82%D0%BE%D0%B2%D1%8B%D0%B9-%D0%BF%D0%BE%D0%BC%D0%BE%D1%89%D0%BD%D0%B8%D0%BA-(Final))

###  Главная страница
Содержимое главной страницы — список первых шести рецептов, отсортированных по дате публикации (от новых к старым).
Остальные рецепты доступны на следующих страницах: внизу страницы есть пагинация.

###  Страница рецепта
На странице — полное описание рецепта. Для авторизованных пользователей — возможность добавить рецепт в избранное и
в список покупок, возможность подписаться на автора рецепта.

### Страница пользователя
На странице — имя пользователя, все рецепты, опубликованные пользователем и возможность подписаться на пользователя.

### Подписка на авторов
Подписка на публикации доступна только авторизованному пользователю. Страница подписок доступна только владельцу.

### Список избранного
Работа со списком избранного доступна только авторизованному пользователю.
Список избранного может просматривать только его владелец.

### Список покупок
Работа со списком покупок доступна авторизованным пользователям.
Список покупок может просматривать только его владелец.
Список покупок скачивается в формате .txt

### Фильтрация по тегам
При нажатии на название тега выводится список рецептов, отмеченных этим тегом. Фильтрация проводится по нескольким
тегам в комбинации «или»: если выбраны несколько тегов — в результате будут показаны рецепты, которые отмечены
хотя бы одним из этих тегов. При фильтрации на странице пользователя фильтруются только рецепты выбранного пользователя.
Такой же принцип соблюдается при фильтрации списка избранного.

### Регистрация и авторизация
В проекте доступна система регистрации и авторизации пользователей.

##  Ресурсы 
- Ресурс **auth**: аутентификация.
- Ресурс **users**: пользователи и подписки
- Ресурс **recipes**: рецепты, теги, ингредиенты, избранные рецепты, список покупок
- Ресурс **api**: весь функционал, только через api-запросы

### Пользовательские роли и права доступа
**Что могут делать неавторизованные пользователи**
- Создать аккаунт
- Просматривать рецепты на главной
- Просматривать отдельные страницы рецептов
- Просматривать страницы пользователей
- Фильтровать рецепты по тегам
- Работать с персональным списком покупок: добавлять/удалять любые рецепты, выгружать файл с количеством необходимых
  ингредиентов для рецептов из списка покупок

**Что могут делать авторизованные пользователи**
- Входить в систему под своим логином и паролем
- Выходить из системы (разлогиниваться)
- Восстанавливать свой пароль
- Менять свой пароль
- Создавать/редактировать/удалять собственные рецепты
- Просматривать рецепты на главной
- Просматривать страницы пользователей
- Просматривать отдельные страницы рецептов
- Фильтровать рецепты по тегам
- Работать с персональным списком избранного: добавлять в него рецепты или удалять их,
  просматривать свою страницу избранных рецептов
- Работать с персональным списком покупок: добавлять/удалять любые рецепты, выгружать файл с количеством необходимых
  ингридиентов для рецептов из списка покупок
- Подписываться на публикации авторов рецептов и отменять подписку, просматривать свою страницу подписок

## Особенности
Проект запускается в четырёх контейнерах docker-compose:
- **frontend** контейнер frontend-части проекта JS-React, подготовит файлы, необходимые для работы фронтенд-приложения,
  и прекратит свою работу
- **web** контейнер backend-части Django приложения
- **nginx** контейнер который отвечает за раздачу статики
- **db** контейнер базы данных через postgres:13.0-alpine

## Подготовка и запуск проекта
### Клонирование репозитория
Склонируйте репозиторий на локальную машину:
```bash
git@github.com:Oleg-2006/foodgram-project-react.git
```

### Запуск и работа с проектом
**Шаг 1** Создайте виртуальное окружение и активируйте его:
```bash
python -m venv venv
source venv/Scripts/activate
```

**Шаг 2** Создайте файл .env командой touch .env и добавьте в него переменные окружения:
```bash
DB_ENGINE=django.db.backends.postgresql
DB_NAME=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=f00dgram
DB_HOST=db
DB_PORT=5432
DJANGO_SECRET_KEY=<ваш_django_секретный_ключ>
```
Чтобы обеспечить безопасность проекта, после добавления .env в `setting.py` необходимо убрать значения *default* в переменных.

**Шаг 3** Обновите pip и установите зависимости:
```bash
python -m pip install --upgrade pip
pip install -r requirements.txt
```

**Шаг 4** Собрать контейнеры:
```bash
cd foodgram-project-react/infra
docker-compose up -d --build
```
При успешном создании контейнеров в терминале должен быть статус:
```
    Status: Downloaded newer image for nginx:1.19.3
    Creating infra_db_1       ... done
    Creating infra_web_1      ... done
    Creating infra_nginx_1    ... done
```

**Шаг 5** Выполнить миграции, собрать статику и создать суперпользователя:
```bash
docker-compose exec -T web python manage.py makemigrations users --noinput
docker-compose exec -T web python manage.py makemigrations recipes --noinput
docker-compose exec -T web python manage.py migrate --noinput
docker-compose exec -T web python manage.py collectstatic --no-input
docker-compose exec web python manage.py createsuperuser
```
Чтобы заполнить базу данных начальными данными списка ингридиетов  и тэгов выполните:
```bash
docker-compose exec -T web python manage.py add_ingredients
docker-compose exec -T web python manage.py add_tags
```
Теперь можно зайти в админку *http://<ваш хост>/admin/* под вашим логином администратора.

### Запуск проекта на удаленном сервере

**Шаг 1** Скопируйте в корень домашней папки на удаленном сервере следующие файлы и директории
- `./docs/*`
- `./frontend/*`
- `./infra/docker-compose.yml`
- `./infra/nginx.config`
- `./infra/.env`

**Шаг 2** Отредактируйте файл .env в корне домашней папки на удаленном сервере, заполните по образцу
из файла .env

**Шаг 3** Установите docker согласно руководству на официальном сайте

**Шаг 4** Запустите проект командой 
```bash
docker-compose up -d --build
```
**Шаг 5** Внутри контейнера создать мигрции, создать суперпользователя, собрать статику, загрузть тэги и игредиенты
```bash
docker-compose exec web python manage.py migrate
docker-compose exec web python manage.py createsuperuser
docker-compose exec web python manage.py collectstatic --no-input
docker-compose exec web python manage.py add_tags
docker-compose exec web python manage.py add_ingredients
```

## Спецификация
Увидеть полную спецификацию API вы сможете в запущенном проекте по адресу http://localhost/api/docs/.

##  Используемые технологии
- проект написан на Python с использованием Django REST Framework
- базы данны PostgreSQL
- библиотека django-filter - фильтрация запросов
- библиотека Djoser - аутентификация
- библиотека Simplejwt - для работы с JWT-токенами
- контейнеризация проекта
  - Docker
  - docker-compose
  - gunicorn
  - nginx

## Авторы
- [Олег Маслов](https://github.com/Oleg-2006)






